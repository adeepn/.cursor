---
alwaysApply: true
tags: ["git", "workflow", "collaboration"]
globs: ["**/*"]
---
# Version Control

Git workflow and collaboration standards.

## Protected Branches - CRITICAL

**Never commit directly to protected branches:**
- `master` / `main`
- `dev` / `develop`

**Always use feature branches and pull requests.**

Before every commit, check current branch. If on protected branch, create feature branch immediately.

**Recovery if accidentally committed:**

```bash
git reset --soft HEAD~1
git checkout -b feature/fix-name
git commit -m "type(scope): description"
```

## Branch Naming

**Pattern:** `type/description`

**Types:**
- `feature/` - New features
- `bugfix/` or `fix/` - Bug fixes
- `hotfix/` - Critical production fixes
- `refactor/` - Code restructuring
- `docs/` - Documentation
- `test/` - Test changes
- `chore/` - Maintenance

**Guidelines:** lowercase with hyphens, descriptive but concise

## Commit Messages

**Format:** `type(scope): description`

**Types:** `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `perf`, `build`, `ci`, `chore`

**Best practices:**
- Clear and concise, present tense
- Describe what and why
- Reference issues when applicable

**Scope examples:**
- General: `auth`, `api`, `ui`, `database`
- Cursor workspace: `cursor-rules`, `cursor-cmd`
- Shared resources: `shared-rules`, `shared-cmd`
- Multi-platform: platform/module name (`esp32`, `backend/api`)

## Commit Practices

**Atomic commits:**
- One logical change per commit
- Each commit should build and pass tests
- Related changes stay together

**Never commit:**
- Secrets, credentials, API keys
- Generated files, build artifacts
- IDE configurations (unless shared)
- Dependencies (node_modules, vendor)
- Large binaries (use Git LFS)

## Workflow

**Starting work:**
1. Pull latest from main branch
2. Create feature branch
3. Make focused changes
4. Commit with clear messages
5. Push to remote

**Before PR:**
- Self-review changes
- Run tests locally
- Update documentation
- No WIP or debug code

## Pull Requests

**Description includes:**
- Clear title
- What changed and why
- Link to related issues
- Breaking changes highlighted

**PR quality:**
- Focused and reasonably sized
- One logical change per PR
- Split large changes

## Code Review

**Focus on:**
- Functionality correctness
- Code quality and readability
- Test coverage
- Security and performance

**Comment prefixes:**
- `nit:` - Minor, not blocking
- `blocking:` - Must fix
- `question:` - Need clarification
- `suggestion:` - Optional improvement

**Giving feedback:** Be constructive, explain reasoning, suggest alternatives

## Merge Strategy

**Before merging:**
- Tests pass, review approved
- No conflicts, CI green
- Documentation updated

**Methods:**
- **Squash and merge** - Feature branches (cleaner history)
- **Rebase and merge** - Linear history preference
- **Merge commit** - Preserve full history

**After merge:** Delete feature branch, monitor for issues

## Release Management

**Semantic versioning:** `MAJOR.MINOR.PATCH`
- MAJOR: Breaking changes
- MINOR: New features (backward compatible)
- PATCH: Bug fixes

**Release branches:** `release/v1.2.3` - only bug fixes, merge to main and dev

**Hotfix branches:** `hotfix/issue-description` - from main, merge to main and dev, tag immediately

**Tags:** `v1.2.3` - annotated with changelog, never delete or move

## CI/CD

**GitHub Actions - always include:**

```yaml
on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]
  workflow_dispatch:  # Manual trigger
```

**Best practices:** Pin action versions, add timeouts, use secrets, cache dependencies

## GitHub CLI

**Essential commands:**
- `gh pr create` - Create PR
- `gh pr checkout <n>` - Checkout PR locally
- `gh run watch` - Monitor CI
- `gh run rerun <id>` - Rerun failed workflow

## Collaboration

- Discuss architectural changes early
- Communicate breaking changes
- Enforce branch protection rules
- Require status checks and reviews

**Note:** Prefer "master" for new projects, or follow existing convention.
