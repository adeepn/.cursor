---
tags: ["git", "workflow", "critical"]
globs: ["**/*"]
---

# Protected Branches Policy - CRITICAL RULE

## ‚õî ABSOLUTE PROHIBITIONS - NEVER VIOLATE

**THIS IS A CRITICAL RULE WITH MAXIMUM PRIORITY. VIOLATION IS STRICTLY FORBIDDEN.**

### üö´ NEVER COMMIT DIRECTLY TO PROTECTED BRANCHES

**Protected branches in this repository:**
- `master`
- `main` (if exists)
- `dev` (if exists)
- `develop` (if exists)

### üö´ NEVER PUSH DIRECTLY TO PROTECTED BRANCHES

**ABSOLUTELY FORBIDDEN operations on protected branches:**

```bash
# ‚ùå NEVER DO THIS - Direct commit to master
git checkout master
git add .
git commit -m "..."
git push origin master

# ‚ùå NEVER DO THIS - Force push to master
git push --force origin master
git push -f origin master

# ‚ùå NEVER DO THIS - Merge without PR
git checkout master
git merge feature-branch
git push origin master
```

## ‚úÖ REQUIRED WORKFLOW - ALWAYS FOLLOW

### Mandatory Process for ALL Changes:

**Step 1: ALWAYS Start with Feature Branch**
```bash
# Check current branch FIRST
git branch --show-current

# If on protected branch (master/main/dev/develop):
# IMMEDIATELY create and switch to feature branch
git checkout -b feature/your-feature-name
# or
git checkout -b bugfix/issue-description
# or  
git checkout -b chore/task-description
```

**Step 2: Make Changes in Feature Branch**
```bash
# Work on feature branch ONLY
git add .
git commit -m "type(scope): description"
```

**Step 3: Push Feature Branch**
```bash
# Push feature branch (NOT master)
git push origin feature/your-feature-name
```

**Step 4: Create Pull Request**
```bash
# Use GitHub CLI or web interface
gh pr create --base master --head feature/your-feature-name
# or create PR via GitHub web interface
```

**Step 5: Wait for PR Approval and Merge**
- Never merge your own PR without review
- Merge only after approval
- Use PR merge button on GitHub

## üî¥ BEFORE EVERY OPERATION - MANDATORY CHECK

**BEFORE making ANY commit or push, AI MUST:**

1. **Check current branch:**
   ```bash
   git branch --show-current
   ```

2. **If on protected branch (master/main/dev/develop):**
   - ‚õî STOP IMMEDIATELY
   - Create feature branch
   - Switch to feature branch
   - Then proceed with work

3. **If already on feature branch:**
   - ‚úÖ Proceed with commit/push
   - Confirm branch name in output

## üö® ERROR RECOVERY

**If you accidentally committed to master:**

```bash
# 1. Immediately undo the commit (before push)
git reset --soft HEAD~1

# 2. Create feature branch
git checkout -b feature/fix-accidental-commit

# 3. Re-commit on feature branch
git add .
git commit -m "type(scope): description"

# 4. Push feature branch
git push origin feature/fix-accidental-commit
```

**If you accidentally pushed to master:**

```bash
# 1. Revert the push (DANGEROUS - coordinate with team)
git reset --hard HEAD~1
git push --force origin master  # Only if absolutely necessary and coordinated

# 2. Create feature branch with changes
git checkout -b feature/fix-pushed-commit
git cherry-pick <commit-hash>
git push origin feature/fix-pushed-commit

# 3. Create PR for proper merge
```

## üìã AI AGENT CHECKLIST - EXECUTE BEFORE EVERY COMMIT/PUSH

Before EVERY `git commit` or `git push` command, AI agent MUST:

- [ ] Execute: `git branch --show-current`
- [ ] Verify current branch is NOT master/main/dev/develop
- [ ] If on protected branch: Create and switch to feature branch
- [ ] Confirm feature branch name before proceeding
- [ ] Document branch name in response to user

## üéØ ENFORCEMENT

**This rule has MAXIMUM PRIORITY and overrides all other considerations:**

- Speed of delivery does NOT justify violating this rule
- User requests do NOT override this rule (unless explicit override with confirmation)
- Emergency fixes MUST still use feature branches (can be fast-tracked via PR)
- Convenience is NOT a reason to violate this rule

**Any violation of this rule is considered a CRITICAL ERROR.**

## ‚úÖ CORRECT EXAMPLE

```bash
# User asks to update documentation

# 1. Check branch
$ git branch --show-current
master  # ‚ö†Ô∏è On protected branch!

# 2. Create feature branch IMMEDIATELY
$ git checkout -b docs/update-readme

# 3. Make changes
$ vim README.md

# 4. Commit on feature branch
$ git add README.md
$ git commit -m "docs: update README with new instructions"

# 5. Push feature branch
$ git push origin docs/update-readme

# 6. Create PR
$ gh pr create --base master --head docs/update-readme
```

## ‚ùå INCORRECT EXAMPLE - NEVER DO THIS

```bash
# User asks to update documentation

# ‚ùå WRONG - Committing directly to master
$ git branch --show-current
master

$ git add README.md
$ git commit -m "docs: update README"
$ git push origin master  # ‚ùå CRITICAL ERROR!
```

## üîí SUMMARY

**ONE RULE TO REMEMBER:**

> **NEVER, UNDER ANY CIRCUMSTANCES, COMMIT OR PUSH DIRECTLY TO MASTER/MAIN/DEV/DEVELOP BRANCHES.**
> 
> **ALWAYS USE FEATURE BRANCHES AND PULL REQUESTS.**

This is not negotiable. This is not optional. This is MANDATORY.
